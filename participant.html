<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Participant Verification</title>
  <style>
    input {
      font-size: 18px;
      padding: 10px;
      width: 200px;
      text-align: center;
    }
  </style>
</head>
<body>

  <h1 id="welcome">Welcome!</h1>

  <div id="dobCheck">
    <p>Please enter your Date of Birth (dd/mm/yyyy):</p>
    <input 
      id="dobInput" 
      placeholder="dd/mm/yyyy" 
      maxlength="10" 
      inputmode="numeric" 
      pattern="\d*" 
      autocomplete="off" 
    />
    <button onclick="checkDOB()">Submit</button>
    <p id="message" style="color: red;"></p>
  </div>

  <div id="successMessage" style="display:none;">
    <h2>You are through!</h2>
  </div>

  <script>
    // Get URL params
    const params = new URLSearchParams(window.location.search);
    const name = params.get("name");
    const correctDOB = params.get("dob");

    // Display participant name
    if (name) {
      document.getElementById("welcome").textContent = `Welcome, ${decodeURIComponent(name)}!`;
    }

    // Auto-format input as dd/mm/yyyy â€” but allow deleting and editing freely
    const dobInput = document.getElementById('dobInput');

    dobInput.addEventListener('input', function (e) {
      const cursorPos = dobInput.selectionStart;
      let value = dobInput.value.replace(/\D/g, '');

      if (value.length > 8) value = value.slice(0, 8);

      let formatted = '';
      if (value.length > 0) formatted += value.slice(0, 2);
      if (value.length >= 3) formatted += '/' + value.slice(2, 4);
      if (value.length >= 5) formatted += '/' + value.slice(4);

      dobInput.value = formatted;

      // Restore cursor position if needed
      if (e.inputType === 'deleteContentBackward') {
        dobInput.setSelectionRange(cursorPos, cursorPos);
      }
    });

    // Check DOB match
    function checkDOB() {
      const input = dobInput.value.trim();
      const message = document.getElementById("message");

      if (!input) {
        message.textContent = 'Please enter your date of birth.';
        return;
      }

      if (input === correctDOB) {
        document.getElementById("dobCheck").style.display = 'none';
        document.getElementById("successMessage").style.display = 'block';
      } else {
        message.textContent = 'Incorrect DOB, please try again.';
      }
    }
  </script>

</body>
</html>
